# 设置系统测试手册

## 测试准备

### 前置条件
1. 确保应用程序可以正常启动
2. 导航到设置页面
3. 准备测试用的JSON配置文件（可选）

## 测试用例

### 1. 设置加载测试 ✅
**目标**: 验证应用启动时正确加载设置

**步骤**:
1. 启动应用程序
2. 导航到设置页面
3. 观察各个设置控件是否显示了正确的默认值

**预期结果**:
- 所有设置控件显示默认值
- 没有错误对话框出现
- 音频设备正确加载

### 2. 设置保存测试
**目标**: 验证UI变化后设置正确保存

**步骤**:
1. 修改一些设置值（如唤醒词、音量等）
2. 点击"保存设置"按钮
3. 重启应用程序
4. 再次检查设置页面

**预期结果**:
- 点击保存后显示成功消息
- 重启后设置值保持修改后的状态
- 本地设置文件正确更新

### 3. 设置导出测试
**目标**: 测试JSON文件导出和文件选择器

**步骤**:
1. 配置一些自定义设置值
2. 点击"导出设置"按钮
3. 在文件选择器中选择保存位置
4. 确认文件已创建
5. 用文本编辑器检查JSON内容

**预期结果**:
- 文件选择器正常显示
- JSON文件成功创建
- 文件内容包含正确的设置值
- 显示导出成功消息

### 4. 设置导入测试
**目标**: 测试从JSON文件导入设置

**步骤**:
1. 准备一个有效的设置JSON文件
2. 点击"导入设置"按钮
3. 选择准备好的JSON文件
4. 观察UI控件是否更新

**预期结果**:
- 文件选择器正常显示
- 成功导入后UI控件更新为JSON文件中的值
- 显示导入成功消息
- 导入的设置能够保存

### 5. 重置设置测试
**目标**: 验证重置到默认值功能

**步骤**:
1. 修改多个设置为非默认值
2. 保存设置
3. 点击"重置为默认值"按钮
4. 确认重置操作

**预期结果**:
- 所有设置恢复为默认值
- UI控件显示默认状态
- 显示重置成功消息

### 6. 实时同步测试
**目标**: 验证设置与UI控件的双向绑定

**步骤**:
1. 逐一修改各个设置控件
2. 观察是否有实时保存到本地设置
3. 测试切换开关、滑块、文本框等不同控件类型

**预期结果**:
- 控件值变化时立即保存到ApplicationData
- 没有延迟或错误
- 所有控件类型都能正确同步

### 7. 错误处理测试
**目标**: 测试各种错误场景的处理

**步骤**:
1. 尝试导入无效的JSON文件
2. 尝试导入格式错误的配置文件
3. 在文件选择器中取消操作
4. 测试没有权限的目录导出

**预期结果**:
- 显示适当的错误消息
- 应用程序不会崩溃
- 错误消息用户友好且具体

### 8. 音频设备测试
**目标**: 验证音频设备加载和刷新功能

**步骤**:
1. 检查音频输入/输出设备是否正确显示
2. 点击"刷新音频设备"按钮
3. 连接/断开音频设备后测试刷新

**预期结果**:
- 正确列出可用的音频设备
- 刷新功能工作正常
- 显示刷新成功消息

## 测试数据

### 示例设置JSON文件
```json
{
  "wakeWordEnabled": true,
  "wakeWords": "小智,xiaozhi",
  "deviceId": "test-device-001",
  "wsAddress": "ws://localhost:8080",
  "wsToken": "test-token-123",
  "defaultVolume": 75.0,
  "autoAdjustVolume": true,
  "audioInputDevice": "默认输入设备",
  "audioOutputDevice": "默认输出设备",
  "autoStart": false,
  "minimizeToTray": true,
  "enableLogging": true,
  "connectionTimeout": 30.0,
  "audioSampleRate": 44100.0,
  "audioChannels": 2.0
}
```

### 无效JSON测试文件
```json
{
  "wakeWordEnabled": "invalid_boolean",
  "defaultVolume": "not_a_number"
}
```

## 性能测试

### 大型配置文件测试
1. 创建包含大量数据的配置文件
2. 测试导入/导出性能
3. 观察内存使用情况

### 并发操作测试
1. 快速连续点击保存按钮
2. 在导出过程中修改设置
3. 测试异步操作的稳定性

## 测试检查清单

- [ ] 设置正确加载
- [ ] 设置成功保存
- [ ] 导出功能正常
- [ ] 导入功能正常
- [ ] 重置功能正常
- [ ] 实时同步工作
- [ ] 错误处理适当
- [ ] 音频设备功能正常
- [ ] 性能满足要求
- [ ] 用户体验良好

## 已知限制

1. **IDE类型解析**: VS Code编辑器可能显示类型错误，但编译正常
2. **文件权限**: 某些系统目录可能没有写入权限
3. **音频设备**: 需要系统支持音频设备枚举

## 故障排除

### 常见问题及解决方案

1. **设置不保存**
   - 检查ApplicationData权限
   - 确认设置服务正确注入

2. **导出失败**
   - 检查目标目录写入权限
   - 确认文件路径有效

3. **导入失败**
   - 验证JSON文件格式
   - 检查文件编码

4. **UI不更新**
   - 确认事件处理程序绑定
   - 检查UI线程调用

## 测试报告模板

```markdown
## 测试报告

**测试日期**: [日期]
**测试人员**: [姓名]
**应用版本**: [版本号]

### 测试结果总结
- 通过测试: X/8
- 失败测试: X/8
- 总体评分: [评分]

### 详细结果
1. 设置加载测试: [通过/失败] - [备注]
2. 设置保存测试: [通过/失败] - [备注]
...

### 发现的问题
1. [问题描述]
2. [问题描述]

### 建议
1. [改进建议]
2. [改进建议]
```
